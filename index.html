<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaebMC - Ultimate Studio</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/otpauth@9/dist/otpauth.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;600;700&family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Playfair+Display:wght@700&family=Space+Grotesk:wght@500;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <script>
        // Apply theme immediately to head to prevent flash
        (function() {
            const theme = localStorage.getItem('studio_theme');
            if (theme === 'dark' || !theme) document.documentElement.classList.add('dark');
        })();
        
        // Handle direct deep links before app.js fully boots
        if (window.location.hash.startsWith('#/u/')) {
            document.addEventListener('DOMContentLoaded', () => {
                const username = window.location.hash.split('/u/')[1];
                if (username && typeof window.showPublicPage === 'function') {
                    window.showPublicPage(username);
                }
            });
        }

        // Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(e => console.warn("SW Error", e));
            });
        }

        // Safe Initialization Check
        window.onerror = function(msg, url, line) {
            const status = document.getElementById('initStatus');
            if (status) {
                const message = typeof msg === 'string' ? msg : (msg.message || "Unknown error");
                status.innerText = "‚ö†Ô∏è ERROR: " + message.substring(0, 30);
                status.className = "mt-4 text-[10px] font-bold uppercase tracking-[0.2em] text-red-500";
            }
            console.error("Studio Error:", msg, url, line);
            return false;
        };
        // Ensure no multiple siteLogos
        document.addEventListener('DOMContentLoaded', () => {
            const logos = document.querySelectorAll('#siteLogo');
            logos.forEach((logo, i) => { if(i > 0) logo.id = 'siteLogo_' + i; });
        });
    </script>
    <style>
        :root {
            --primary: #4ade80; /* Emerald Green */
            --primary-rgb: 74, 222, 128;
            --primary-hover: #22c55e;
            --secondary: #22d3ee; /* Diamond Blue */
            --bg-base: #0a0a0c;
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --card-bg: rgba(20, 20, 25, 0.6);
            --border-color: rgba(255, 255, 255, 0.12);
            --input-bg: rgba(0, 0, 0, 0.4);
            --glass-blur: 50px;
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
        }

        .dark {
            --bg-base: #050505;
            --card-bg: rgba(10, 10, 15, 0.7);
            --primary: #4ade80;
        }

        body {
            background: var(--bg-base);
            color: var(--text-main);
            font-family: 'Space Grotesk', 'Inter', sans-serif;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            background-attachment: fixed;
        }

        /* iOS 25 x Minecraft Blobs */
        .blobs-container {
            position: fixed;
            inset: 0;
            z-index: -1;
            filter: blur(100px);
            opacity: 0.8;
            overflow: hidden;
        }

        .blob {
            position: absolute;
            width: 45vw;
            height: 45vw;
            border-radius: 20%; /* Blocky Minecraft feel */
            animation: float 25s infinite alternate ease-in-out;
            opacity: 0.6;
        }

        .blob-1 {
            background: linear-gradient(135deg, #059669, #10b981); /* Emerald */
            top: -10%; left: -10%;
            border-radius: 35%;
        }

        .blob-2 {
            background: linear-gradient(135deg, #0891b2, #06b6d4); /* Diamond */
            bottom: -10%; right: -10%;
            animation-duration: 30s;
            border-radius: 30%;
        }

        .blob-3 {
            background: linear-gradient(135deg, #f59e0b, #fbbf24); /* Minecraft Gold */
            top: 20%; right: 10%;
            animation-duration: 20s;
            mix-blend-mode: color-dodge;
            border-radius: 40%;
        }

        .blob-4 {
            background: linear-gradient(135deg, #dc2626, #f87171); /* Redstone */
            bottom: 20%; left: 5%;
            animation-duration: 35s;
            border-radius: 25%;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg) scale(1); }
            50% { transform: translate(10%, 5%) rotate(5deg) scale(1.1); }
            100% { transform: translate(-5%, 10%) rotate(-5deg) scale(0.95); }
        }

        .glass {
            background: var(--card-bg) !important;
            backdrop-filter: blur(var(--glass-blur)) saturate(250%) !important;
            -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(250%) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 
                0 25px 60px rgba(0,0,0,0.5),
                inset 0 1px 1px rgba(255,255,255,0.15),
                0 0 0 1px rgba(255,255,255,0.05) inset !important;
            border-radius: 28px !important;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* Minecraft Pixel Texture Overlay */
        .glass::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h1v1H0V0zm2 2h1v1H2V2z' fill='%23ffffff' fill-opacity='0.04' fill-rule='evenodd'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 1;
        }

        /* Glass Top Shimmer */
        .glass::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 40%, transparent 100%);
            pointer-events: none;
            z-index: 2;
        }

        .glass:hover {
            transform: translateY(-4px) scale(1.01);
            border-color: rgba(255,255,255,0.2) !important;
            box-shadow: 0 30px 60px rgba(0,0,0,0.6) !important;
        }

        input, select, textarea {
            background: var(--input-bg) !important;
            border: 1px solid var(--border-color) !important;
            color: white !important;
            border-radius: 12px !important;
            backdrop-filter: blur(10px);
        }

        input:focus {
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.2) !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary)) !important;
            color: #000 !important;
            font-weight: 700 !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.3) !important;
            transition: all 0.3s ease !important;
        }

        .btn-primary:hover {
            transform: scale(1.03);
            filter: brightness(1.1);
            box-shadow: 0 8px 25px rgba(74, 222, 128, 0.5) !important;
        }

        .message-mine {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            color: #000 !important;
            font-weight: 500;
        }

        .message-others {
            background: rgba(255,255,255,0.1) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.05) !important;
        }

        /* Custom Scrollbar Obsidian Style */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb {
            background: rgba(74, 222, 128, 0.3);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        .loading-logo {
            animation: pulse-minecraft 1.5s infinite;
        }

        @keyframes pulse-minecraft {
            0% { transform: scale(1); filter: drop-shadow(0 0 0px var(--primary)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 20px var(--primary)); }
            100% { transform: scale(1); filter: drop-shadow(0 0 0px var(--primary)); }
        }

        #initStatus {
            color: var(--primary);
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }

        /* ============================================
           HYPER-GLASS MODALS - iOS 25 Style
           ============================================ */
        #chatModal, 
        #ownerPanelModal, 
        #pageEditorModal, 
        #manageUserModal, 
        #notificationsModal, 
        #groupMembersModal, 
        #editProfileModal, 
        #tfaModal, 
        #cloudSyncModal {
            background: rgba(255, 255, 255, 0.12) !important;
            backdrop-filter: blur(80px) saturate(200%) brightness(1.05) !important;
            -webkit-backdrop-filter: blur(80px) saturate(200%) brightness(1.05) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                0 1px 0 rgba(255, 255, 255, 0.4) inset !important;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
        }

        .dark #chatModal, 
        .dark #ownerPanelModal, 
        .dark #pageEditorModal, 
        .dark #manageUserModal, 
        .dark #notificationsModal, 
        .dark #groupMembersModal, 
        .dark #editProfileModal, 
        .dark #tfaModal, 
        .dark #cloudSyncModal {
            background: rgba(15, 15, 30, 0.7) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.6),
                0 0 100px rgba(139, 92, 246, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.05) inset,
                0 1px 0 rgba(255, 255, 255, 0.1) inset !important;
        }

        /* Glass Shine + Grain for All Modals */
        #chatModal::before, 
        #ownerPanelModal::before, 
        #pageEditorModal::before,
        #cloudSyncModal::before,
        #editProfileModal::before,
        #tfaModal::before {
            content: "";
            position: absolute;
            inset: 0;
            background: 
                linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 40%, transparent 60%, rgba(255,255,255,0.1) 100%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.04;
            pointer-events: none;
            z-index: 0;
            border-radius: inherit;
        }

        .dark #chatModal::before, 
        .dark #ownerPanelModal::before, 
        .dark #pageEditorModal::before,
        .dark #cloudSyncModal::before {
            background: 
                linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, transparent 40%, transparent 60%, rgba(99, 102, 241, 0.1) 100%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.06;
        }


        
        /* Glassy Inputs */
        input, select, textarea {
            background: var(--input-bg) !important;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color) !important;
            transition: all 0.3s ease;
            border-radius: 12px !important;
            padding: 12px 16px !important;
        }

        input:focus {
            background: rgba(255, 255, 255, 0.2) !important;
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }

        /* Ultimate Dark Mode Coverage */
        .dark .bg-white, 
        .dark .bg-gray-50, 
        .dark .bg-gray-100,
        .dark .bg-gray-200 { background-color: var(--card-bg) !important; }
        
        .dark .text-gray-900, 
        .dark .text-gray-800, 
        .dark .text-gray-700,
        .dark .text-black { color: var(--text-main) !important; }
        
        .dark .text-gray-600, 
        .dark .text-gray-500, 
        .dark .text-gray-400 { color: var(--text-muted) !important; }
        
        .dark .border-gray-200, 
        .dark .border-gray-100,
        .dark .border-gray-300 { border-color: var(--border-color) !important; }

        .dark .hover\:bg-gray-100:hover,
        .dark .hover\:bg-gray-50:hover { background-color: var(--btn-gray-hover) !important; }

        .dark .bg-purple-600 { background-color: var(--primary) !important; color: #020617 !important; }
        .dark .hover\:bg-purple-700:hover { background-color: var(--primary-hover) !important; }
        
        .dark input, 
        .dark select, 
        .dark textarea {
            background-color: var(--input-bg) !important;
            border-color: var(--border-color) !important;
            color: var(--text-main) !important;
        }
        
        .dark .btn-primary { background-color: var(--primary) !important; color: #000 !important; }
        .dark .btn-primary:hover { background-color: var(--primary-hover) !important; }
        
        .dark .bg-purple-100 { background-color: rgba(167, 139, 250, 0.1) !important; color: var(--primary) !important; }
        .dark .bg-blue-100 { background-color: rgba(59, 130, 246, 0.1) !important; color: #60a5fa !important; }
        .dark .bg-rose-500 { background-color: #f43f5e !important; }

        /* iOS 25 Refractive Textures */
        .glass::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(125deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 40%, rgba(255,255,255,0) 60%, rgba(255,255,255,0.2) 100%);
            opacity: 0.3;
            pointer-events: none;
            z-index: 2;
        }

        .dark .glass::after {
            background: linear-gradient(125deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 40%, rgba(255,255,255,0) 60%, rgba(255,255,255,0.05) 100%);
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .glass {
                border-radius: 20px !important;
                --glass-blur: 25px;
            }
            /* Chat Mobile Overhaul */
            #chatModal {
                height: 100vh !important;
                max-height: 100vh !important;
                width: 100vw !important;
                max-width: 100vw !important;
                border-radius: 0 !important;
                flex-direction: column !important;
                top: 0 !important;
                left: 0 !important;
                transform: none !important;
                z-index: 9999;
            }
            #chatSidebar {
                position: absolute !important;
                top: 60px !important;
                left: -100% !important;
                width: 85% !important;
                height: calc(100% - 60px) !important;
                z-index: 100 !important;
                transition: left 0.4s cubic-bezier(0.16, 1, 0.3, 1) !important;
                border-right: 1px solid var(--border-color) !important;
                background: rgba(10, 10, 15, 0.9) !important;
                backdrop-filter: blur(40px) saturate(200%) !important;
            }
            #chatSidebar.mobile-sidebar-active {
                left: 0 !important;
                box-shadow: 40px 0 80px rgba(0,0,0,0.8);
            }
            #chatSidebar.mobile-sidebar-active::after {
                content: "";
                position: absolute;
                top: 0; right: 0; bottom: 0; width: 1px;
                background: linear-gradient(to bottom, transparent, var(--primary), transparent);
            }
            #chatSidebarContent {
                display: block !important;
                height: 100% !important;
                max-height: none !important;
            }
            /* Owner Panel Mobile Overhaul */
            #ownerPanelModal {
                height: 100vh !important;
                max-height: 100vh !important;
                width: 100vw !important;
                max-width: 100vw !important;
                border-radius: 0 !important;
                flex-direction: column !important;
            }
            #ownerPanelModal > div.flex-1 {
                flex-direction: column !important;
            }
            #ownerPanelModal .w-64 {
                width: calc(100% - 20px) !important;
                height: auto !important;
                display: flex !important;
                overflow-x: auto !important;
                padding: 8px !important;
                margin: 10px !important;
                border: 1px solid var(--border-color);
                border-radius: 16px !important;
                background: rgba(0,0,0,0.2) !important;
            }
            #ownerPanelModal .w-64 button {
                white-space: nowrap !important;
                flex: 1 !important;
                text-align: center !important;
                margin-bottom: 0 !important;
                margin-right: 4px !important;
                padding: 10px !important;
                font-size: 11px !important;
            }
            .chat-main-view {
                flex: 1;
            }
            nav {
                padding: 10px !important;
            }
            #siteTitle {
                display: none;
            }
            #dashboard {
                padding-bottom: 80px;
            }
            #onlineStatusBadge {
                display: none !important;
            }
        }

        .btn-primary { 
            background: linear-gradient(135deg, var(--primary), #6366f1);
            color: white; 
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border: none;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        .btn-primary:hover { 
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        .btn-primary:active {
            transform: translateY(0) scale(0.98);
        }

        /* iOS Message Bubbles */
        .message-bubble {
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 12px 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .message-mine {
            background: linear-gradient(180deg, #007aff, #0056b3) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3) !important;
        }

        .message-others {
            background: rgba(255, 255, 255, 0.5) !important;
            backdrop-filter: blur(15px) saturate(200%);
            color: #000 !important;
            border: 1px solid rgba(255, 255, 255, 0.5) !important;
        }
        .dark .message-others {
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(15px) saturate(200%);
            color: #fff !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }

        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tab-active {
            background-color: var(--primary);
            color: white;
        }
    </style>
</head>
<body class="custom-scrollbar">
    <div id="toast-container"></div>

    <!-- iOS 25 Blobs -->
    <div class="blobs-container">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
        <div class="blob blob-4"></div>
    </div>

    <!-- Sick Loader -->
    <div id="loadingScreen" class="hidden fixed inset-0 z-[100] bg-white/5 dark:bg-black/10 backdrop-blur-3xl flex flex-col items-center justify-center transition-all duration-300">
        <div class="relative">
            <div class="w-20 h-20 border-4 border-purple-500/20 border-t-purple-600 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <div id="siteLogo" class="w-10 h-10 bg-purple-600 text-white rounded-xl flex items-center justify-center text-xl font-bold shadow-lg">S</div>
            </div>
        </div>
        <div class="mt-6 text-center">
            <p class="text-sm font-bold uppercase tracking-[0.2em] text-purple-600 animate-pulse">SaebMC Studio</p>
            <p id="loadingStatusText" class="text-xs text-gray-500 mt-2">Ready</p>
        </div>
    </div>
    
    <!-- Notification Permission Banner -->
    <div id="notifBanner" class="hidden fixed top-0 left-0 w-full bg-purple-600 text-white p-3 z-[100] flex items-center justify-between shadow-lg">
        <div class="flex items-center space-x-3">
            <i class="fas fa-bell"></i>
            <span class="text-sm font-medium">Allow desktop notifications to never miss a message?</span>
        </div>
        <div class="flex space-x-2">
            <button onclick="requestNotifPermission()" class="px-4 py-1 bg-white text-purple-600 rounded-lg text-xs font-bold uppercase">Allow</button>
            <button onclick="this.parentElement.parentElement.remove()" class="px-4 py-1 bg-purple-500 text-white rounded-lg text-xs font-bold uppercase">Later</button>
        </div>
    </div>

    <!-- Auth Pages -->
    <div id="loginPage" class="flex items-center justify-center min-h-screen p-4">
        <div class="glass w-full max-w-md p-8 relative z-10">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg shadow-emerald-500/30">
                   <span class="text-3xl font-bold text-black">S</span>
                </div>
                <h1 class="text-3xl font-bold mb-2 tracking-tight">SaebMC Studio</h1>
                <p class="text-gray-400 text-sm">Authentication Protocol v25.0</p>
                <div id="initStatus" class="mt-4 text-[10px] font-bold uppercase tracking-[0.2em] opacity-80">üì° Initializing Core...</div>
            </div>

            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-2">Identification</label>
                    <input type="text" id="loginUsername" class="w-full p-4 outline-none transition-all" placeholder="Username" required>
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-2">Access Key</label>
                    <input type="password" id="loginPassword" class="w-full p-4 outline-none transition-all" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn-primary w-full p-4 rounded-xl font-bold uppercase tracking-widest mt-4">Authorize Access</button>
            </form>
            <p class="text-center mt-8 text-xs text-gray-500">
                New user detected? <a href="#" onclick="showRegister()" class="text-emerald-400 font-bold hover:text-emerald-300 transition-colors uppercase ml-1">Establish Account</a>
            </p>
            <div class="text-center mt-10">
                <button onclick="localStorage.clear(); sessionStorage.clear(); location.reload();" class="text-[9px] text-gray-600 hover:text-red-500 uppercase tracking-[0.2em] transition-all">Emergency System Reset</button>
            </div>
        </div>
    </div>

    <div id="registerPage" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="glass w-full max-w-md p-8 rounded-2xl shadow-2xl">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold mb-2">Create Account</h1>
                <p class="text-gray-500">Join the SaebMC community</p>
            </div>
            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Full Name</label>
                    <input type="text" id="regName" class="w-full p-3 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-purple-500" placeholder="John Doe" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Username</label>
                    <input type="text" id="regUsername" class="w-full p-3 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-purple-500" placeholder="johndoe" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Password</label>
                    <input type="password" id="regPassword" class="w-full p-3 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-purple-500" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn-primary w-full p-3 rounded-lg font-semibold mt-4">Sign Up</button>
            </form>
            <p class="text-center mt-6 text-sm">
                Already have an account? <a href="#" onclick="showLogin()" class="text-purple-600 font-semibold hover:underline">Log In</a>
            </p>
        </div>
    </div>

    <div id="tfaPage" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="glass w-full max-w-md p-8 rounded-2xl shadow-2xl">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl"><i class="fas fa-shield-alt"></i></div>
                <h1 class="text-2xl font-bold mb-2">Two-Factor Authentication</h1>
                <p class="text-gray-500">Enter the 6-digit code from your app</p>
            </div>
            <form id="tfaForm" class="space-y-4">
                <input type="text" id="tfaCode" maxlength="6" class="w-full p-4 text-center text-3xl font-bold tracking-widest rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-purple-500" placeholder="000000" required>
                <button type="submit" class="btn-primary w-full p-3 rounded-lg font-semibold">Verify</button>
            </form>
            <button onclick="showLogin()" class="w-full mt-4 text-sm text-gray-500 hover:text-purple-600">Back to Login</button>
        </div>
    </div>

    <!-- Public Page View -->
    <div id="publicPage" class="hidden min-h-screen flex items-center justify-center p-4">
        <div id="pageContainer" class="w-full max-w-2xl glass p-8 rounded-3xl shadow-2xl relative overflow-hidden">
            <button id="publicBackBtn" onclick="goBackFromPublic()" class="absolute top-6 left-6 p-3 bg-white/10 hover:bg-white/20 backdrop-blur-xl border border-white/20 rounded-full transition-all z-[100] shadow-xl group active:scale-90" title="Back">
                <i class="fas fa-arrow-left text-white group-hover:-translate-x-1 transition-transform"></i>
            </button>
            <button id="publicCopyBtn" onclick="copyProfileLink()" class="absolute top-6 right-6 p-3 bg-white/10 hover:bg-white/20 backdrop-blur-xl border border-white/20 rounded-full transition-all z-[100] flex items-center justify-center w-12 h-12 shadow-xl group active:scale-90" title="Copy Page Link">
                <i class="fas fa-link text-white group-hover:rotate-12 transition-transform"></i>
            </button>
            <div id="pageContent" class="relative z-10 text-center">
                <div id="pageAvatar" class="w-32 h-32 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-6xl mx-auto mb-6 shadow-xl border-4 border-white/30">üëã</div>
                <h1 id="pageName" class="text-4xl font-bold mb-2">Display Name</h1>
                <p id="pageUsername" class="text-lg opacity-70 mb-6">@username</p>
                <div id="pageBioDisplay" class="text-lg mb-8 max-w-md mx-auto leading-relaxed">This is the user bio area.</div>
                
                <div id="pageSocialsDisplay" class="flex flex-wrap justify-center gap-4">
                    <!-- Social icons will be injected here -->
                </div>
            </div>
            <!-- Decorative background elements -->
            <div id="patternOverlay" class="absolute inset-0 opacity-10 pointer-events-none"></div>
            <div class="absolute -top-24 -right-24 w-64 h-64 bg-white/10 rounded-full blur-3xl"></div>
            <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-black/10 rounded-full blur-3xl"></div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden min-h-screen">
        <nav class="glass p-4 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-2 cursor-pointer" onclick="showDashboard()">
                    <div id="navLogo" class="w-10 h-10 bg-purple-600 text-white rounded-xl flex items-center justify-center text-xl font-bold">S</div>
                    <span id="navTitle" class="text-xl font-bold hidden md:block">SaebMC</span>
                </div>
                <div class="flex items-center space-x-2 md:space-x-3">
                    <div id="onlineStatusBadge" class="hidden sm:flex items-center space-x-2 text-[10px] font-bold uppercase mr-2">
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>Online</span>
                    </div>
                    <button onclick="toggleDarkMode()" class="p-1.5 md:p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 transition-colors" title="Toggle Dark Mode">
                        <i id="themeIcon" class="fas fa-moon"></i>
                    </button>
                    <button onclick="openNotifications()" class="p-1.5 md:p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 transition-colors relative">
                        <i class="fas fa-bell"></i>
                        <span id="notifBadge" class="hidden absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[10px] rounded-full flex items-center justify-center border-2 border-white"></span>
                    </button>
                    <button onclick="openChat()" class="p-1.5 md:p-2 rounded-lg bg-purple-100 text-purple-600 hover:bg-purple-200 transition-colors" title="Chat">
                        <i class="fas fa-comments"></i>
                    </button>
                    <div id="ownerPanelBtn" class="hidden">
                        <button onclick="openOwnerPanel()" class="px-2 md:px-4 py-1.5 md:py-2 rounded-lg bg-rose-500 text-white font-semibold hover:bg-rose-600 transition-colors">
                            <i class="fas fa-crown md:mr-1"></i> <span class="hidden md:inline">Owner</span>
                        </button>
                    </div>
                    <button onclick="logout()" class="p-1.5 md:p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 transition-colors" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto p-4 md:p-8 space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass p-6 rounded-2xl md:col-span-1 text-center h-fit">
                    <div id="userAvatar" class="w-24 h-24 bg-gradient-to-br from-purple-500 to-indigo-600 text-white rounded-3xl flex items-center justify-center text-4xl font-bold mx-auto mb-4 shadow-lg">?</div>
                    <h2 id="displayName" class="text-2xl font-bold">User Name</h2>
                    <p id="displayUsername" class="text-purple-600 font-medium mb-4">@username</p>
                    <div id="userRoleBadge" class="inline-block px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider mb-6">User</div>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="openEditProfile()" class="w-full p-2 bg-gray-100 dark:bg-gray-800 rounded-lg text-sm font-semibold hover:bg-gray-200 dark:hover:bg-gray-700">
                                <i class="fas fa-user-edit mr-1"></i> Profile
                            </button>
                            <button onclick="openPageEditorModal()" class="w-full p-2 bg-blue-100 text-blue-600 rounded-lg text-sm font-semibold hover:bg-blue-200">
                                <i class="fas fa-palette mr-1"></i> Edit Page
                            </button>
                        </div>
                        <button onclick="viewMyPage()" class="w-full p-3 bg-purple-100 text-purple-600 rounded-lg text-sm font-bold hover:bg-purple-200 flex items-center justify-center space-x-2">
                            <i class="fas fa-external-link-alt"></i> 
                            <span>View Public Profile</span>
                        </button>
                    </div>
                </div>

                <div class="md:col-span-2 space-y-6">
                    <div class="glass p-8 rounded-2xl">
                        <h3 class="text-2xl font-bold mb-4">Welcome back!</h3>
                        <p class="text-gray-500 mb-6">Explore your dashboard and manage your SaebMC Studio experience.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-100 dark:border-purple-800">
                                <div class="text-purple-600 mb-2"><i class="fas fa-shield-alt text-xl"></i></div>
                                <h4 class="font-bold">2FA Status</h4>
                                <p id="tfaStatus" class="text-sm text-gray-600 dark:text-gray-400">Disabled</p>
                                <button onclick="openTFAModal()" class="mt-2 text-xs font-bold text-purple-600 uppercase hover:underline">Manage Security</button>
                            </div>
                            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-100 dark:border-blue-800">
                                <div class="text-blue-600 mb-2"><i class="fas fa-palette text-xl"></i></div>
                                <h4 class="font-bold">Page Editor</h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400">Customize your public presence</p>
                                <button onclick="openPageEditorModal()" class="mt-2 text-xs font-bold text-blue-600 uppercase hover:underline">Edit Page</button>
                            </div>
                        </div>
                    </div>
                    <div id="dashboardAlerts"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modalOverlay" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 overflow-y-auto">
        <!-- Edit Profile Modal -->
        <div id="editProfileModal" class="hidden glass w-full max-w-lg p-6 md:p-8 rounded-2xl shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-50"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-bold mb-6">Edit Profile</h2>
            <form id="editProfileForm" class="space-y-4 overflow-y-auto max-h-[70vh] pr-2 custom-scrollbar">
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-emerald-500 mb-1">Identity</label>
                    <input type="text" id="editName" class="w-full p-3 rounded-lg outline-none" placeholder="Full Name">
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1">Status Message</label>
                    <input type="text" id="editStatusText" class="w-full p-3 rounded-lg outline-none" placeholder="Feeling obsidian...">
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1">Pronouns</label>
                    <input type="text" id="editPronouns" class="w-full p-3 rounded-lg outline-none" placeholder="they/them">
                </div>
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1">Username (Handle)</label>
                    <input type="text" id="editUsername" class="w-full p-3 rounded-lg outline-none" placeholder="username" disabled>
                    <p class="text-[9px] text-gray-500 mt-1 uppercase">Username changes are restricted to admin approval.</p>
                </div>
                
                <div class="p-4 bg-white/5 rounded-2xl border border-white/10 space-y-4">
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-emerald-500">Security & Keys</label>
                    <div>
                        <input type="password" id="editNewPassword" class="w-full p-3 rounded-lg outline-none text-sm" placeholder="New Password (leave blank to keep)">
                    </div>
                    <div>
                        <input type="password" id="editConfirmPassword" class="w-full p-3 rounded-lg outline-none text-sm" placeholder="Confirm New Password">
                    </div>
                </div>

                <div class="flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/10">
                    <div>
                        <span class="block text-sm font-bold">Studio Notifications</span>
                        <span class="text-[10px] text-gray-500 uppercase">Toast and system alerts</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="editNotifsEnabled" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500 shadow-inner"></div>
                    </label>
                </div>

                <button type="submit" class="w-full p-4 rounded-xl font-bold uppercase tracking-widest mt-4 shadow-lg active:scale-95 transition-all bg-gradient-to-r from-emerald-500 to-emerald-600 text-black hover:shadow-emerald-500/20">Apply Profile Changes</button>
            </form>
        </div>

        <!-- Page Editor Modal -->
        <div id="pageEditorModal" class="hidden glass w-full max-w-2xl p-6 md:p-8 rounded-2xl shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-bold mb-2">Edit Public Page</h2>
            <p class="text-sm text-gray-500 mb-6">Customize how you appear to others in the SaebMC community.</p>
            <form id="pageEditorForm" class="space-y-6 overflow-y-auto max-h-[75vh] pr-2 custom-scrollbar">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Display Name</label>
                            <input type="text" id="pageDisplayName" class="w-full p-3 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-purple-500" placeholder="Your Page Name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Custom Bio</label>
                            <textarea id="pageBio" rows="4" class="w-full p-3 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-purple-500" placeholder="Tell the world about yourself..."></textarea>
                            <div class="flex space-x-3 mt-2">
                                <button type="button" onclick="suggestBio()" class="text-xs text-purple-600 font-bold uppercase hover:underline">‚ú® Suggest Bio</button>
                                <button type="button" onclick="aiAutoStyle()" class="text-xs text-blue-600 font-bold uppercase hover:underline">ü§ñ AI Auto-Style</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Page Avatar Emoji</label>
                            <input type="text" id="pageAvatarEmoji" class="w-full p-3 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-purple-500" placeholder="üëã">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Font Weight</label>
                            <select id="pageFontWeight" class="w-full p-3 rounded-lg border border-gray-200 outline-none">
                                <option value="normal">Normal</option>
                                <option value="bold">Bold</option>
                                <option value="lighter">Light</option>
                            </select>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Theme Primary Color</label>
                            <div class="flex items-center space-x-2">
                                <input type="color" id="pageThemeColor" class="flex-1 h-12 rounded-lg cursor-pointer bg-transparent border-none">
                                <button type="button" onclick="randomTheme()" class="p-3 bg-gray-100 dark:bg-gray-800 rounded-lg" title="Random Theme"><i class="fas fa-magic"></i></button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Font Choice</label>
                            <select id="pageFont" class="w-full p-3 rounded-lg border border-gray-200 outline-none">
                                <option value="Inter">Inter (Sans)</option>
                                <option value="Poppins">Poppins (Modern)</option>
                                <option value="Playfair Display">Playfair (Serif)</option>
                                <option value="JetBrains Mono">JetBrains (Mono)</option>
                                <option value="Space Grotesk">Space Grotesk</option>
                                <option value="Montserrat">Montserrat</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Border Radius</label>
                            <input type="range" id="pageBorderRadius" min="0" max="40" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Social Links (JSON)</label>
                            <textarea id="pageSocialLinks" rows="3" class="w-full p-3 rounded-lg border border-gray-200 font-mono text-xs" placeholder='{"Twitter": "...", "GitHub": "..."}'></textarea>
                            <p class="text-[10px] text-gray-400 mt-1">Example: {"Twitter": "https://twitter.com/..."}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Custom Background Pattern</label>
                            <select id="pagePattern" class="w-full p-3 rounded-lg border border-gray-200 outline-none">
                                <option value="none">Solid Color</option>
                                <option value="dots">Dots</option>
                                <option value="grid">Grid</option>
                                <option value="bubbles">Bubbles</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn-primary w-full p-4 rounded-xl font-bold shadow-lg transform transition active:scale-95">Save Changes</button>
            </form>
        </div>

        <!-- Chat Modal -->
        <div id="chatModal" class="hidden glass w-full max-w-5xl h-[650px] rounded-2xl shadow-2xl flex overflow-hidden">
            <div id="chatSidebar" class="w-full md:w-72 border-r border-gray-200 dark:border-gray-700 flex flex-col bg-gray-50/50 dark:bg-gray-900/50">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex justify-between items-center">
                    <h3 class="text-lg font-bold">Chat Studio</h3>
                    <button onclick="closeModal()" class="md:hidden p-2 text-gray-400"><i class="fas fa-times"></i></button>
                </div>
                <div class="flex p-2 bg-white/50 dark:bg-gray-900/50 space-x-1">
                    <button onclick="setChatMode('public')" id="btnTabPublic" class="flex-1 p-2 rounded-lg text-xs font-bold uppercase transition-colors">Public</button>
                    <button onclick="setChatMode('dm')" id="btnTabDM" class="flex-1 p-2 rounded-lg text-xs font-bold uppercase transition-colors">DMs</button>
                    <button onclick="setChatMode('groups')" id="btnTabGroups" class="flex-1 p-2 rounded-lg text-xs font-bold uppercase transition-colors">Groups</button>
                </div>
                <div class="flex-1 overflow-y-auto custom-scrollbar p-2" id="chatSidebarContent"></div>
            </div>
            <div class="flex-1 flex flex-col bg-white dark:bg-gray-900 chat-main-view">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                    <div>
                        <div class="flex items-center space-x-2">
                            <!-- Sidebar Toggle (Mobile) -->
                            <button onclick="toggleChatSidebar()" class="md:hidden mr-2 p-2 bg-purple-600/20 text-purple-400 rounded-xl active:scale-90 transition-all">
                                <i class="fas fa-bars"></i>
                            </button>
                            <h4 id="chatChannelTitle" class="font-bold">üåê Public Chat</h4>
                            <div id="chatConnStatus" class="w-2 h-2 rounded-full bg-gray-300" title="Checking connection..."></div>
                        </div>
                        <p id="chatChannelStatus" class="text-xs text-gray-500">Everyone can see messages here</p>
                    </div>
                    <div class="flex space-x-2">
                        <div id="groupAdminActions" class="hidden flex space-x-3 items-center">
                            <button onclick="manageGroupMembers()" class="px-3 py-2 bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 rounded-2xl transition-all flex items-center space-x-2" title="Manage Members">
                                <i class="fas fa-users-cog text-sm"></i>
                                <span class="text-[10px] font-bold uppercase tracking-widest hidden md:inline">Authority</span>
                            </button>
                            <button onclick="deleteCurrentGroup()" class="p-2 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded-xl transition-all" title="Delete Group">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                        <button onclick="closeModal()" class="hidden md:block p-2 text-gray-400 hover:text-white transition-colors"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar bg-gray-50/30 dark:bg-gray-950/30"></div>
                <div class="p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 pb-safe">
                    <div id="imagePreview" class="hidden mb-2 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center space-x-2">
                        <img id="previewImg" src="" class="h-12 w-12 object-cover rounded">
                        <span class="text-xs text-gray-500 flex-1 truncate">image.png</span>
                        <button onclick="clearImagePreview()" class="text-red-500"><i class="fas fa-times"></i></button>
                    </div>
                    <form id="chatForm" class="flex space-x-2 items-center">
                        <label class="cursor-pointer p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors">
                            <i class="fas fa-camera text-emerald-500"></i>
                            <input type="file" id="chatFile" class="hidden" accept="image/*" onchange="handleFilePreview(this)">
                        </label>
                        <input type="text" id="chatInput" class="flex-1 p-3 rounded-xl border border-gray-200 dark:border-gray-700 outline-none focus:ring-2 focus:ring-purple-500 dark:bg-gray-800" placeholder="Type a message...">
                        <button type="submit" class="p-3 bg-purple-600 text-white rounded-xl w-12 flex items-center justify-center hover:bg-purple-700 transition-transform active:scale-95">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Manage Group Members Modal -->
        <div id="groupMembersModal" class="hidden glass w-full max-w-md p-8 rounded-3xl shadow-2xl relative z-10">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors"><i class="fas fa-times"></i></button>
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-10 h-10 bg-emerald-500 text-black rounded-xl flex items-center justify-center"><i class="fas fa-users"></i></div>
                <h2 class="text-2xl font-bold">Group Authority</h2>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-emerald-500 mb-2">Active Members</label>
                    <div id="groupMembersList" class="space-y-2 mb-6 max-h-48 overflow-y-auto custom-scrollbar bg-black/20 p-2 rounded-2xl">
                        <!-- Members will be injected here -->
                    </div>
                </div>

                <div class="p-4 bg-white/5 rounded-2xl border border-white/10">
                    <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-3">Invite Member</label>
                    <div class="flex space-x-2">
                        <input type="text" id="addMemberUsername" class="flex-1 p-3 text-sm bg-black/40 border-none outline-none focus:ring-1 focus:ring-emerald-500 transition-all" placeholder="Enter username...">
                        <button onclick="addMemberToGroup()" class="px-4 py-2 bg-emerald-500 text-black rounded-xl font-bold text-xs uppercase tracking-widest hover:scale-105 active:scale-95 transition-all">Add</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2FA Setup Modal -->
        <div id="tfaModal" class="hidden glass w-full max-w-md p-8 rounded-2xl shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-bold mb-4">Security Settings</h2>
            <div id="tfaSetup" class="space-y-4">
                <p class="text-sm text-gray-500">Enable 2FA to secure your account with Google Authenticator.</p>
                <div id="qrcode" class="mx-auto bg-white p-2 rounded-lg w-fit"></div>
                <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg text-xs font-mono break-all text-center" id="tfaSecretKey"></div>
                <input type="text" id="tfaVerifyCode" maxlength="6" class="w-full p-3 text-center text-xl font-bold tracking-widest rounded-lg border" placeholder="Verify Code">
                <button onclick="confirmEnable2FA()" class="btn-primary w-full p-3 rounded-lg font-semibold">Enable 2FA</button>
            </div>
            <div id="tfaActive" class="hidden space-y-4 text-center">
                <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto text-2xl"><i class="fas fa-check"></i></div>
                <h3 class="text-xl font-bold">2FA is Active</h3>
                <p class="text-sm text-gray-500">Your account is protected by two-factor authentication.</p>
                <button onclick="disable2FA()" class="w-full p-3 border border-red-200 text-red-600 rounded-lg font-semibold hover:bg-red-50">Disable 2FA</button>
            </div>
        </div>
        
        <!-- Owner Panel Modal -->
        <div id="ownerPanelModal" class="hidden glass w-full max-w-5xl h-[700px] rounded-2xl shadow-2xl flex flex-col overflow-hidden">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 bg-rose-500 text-white flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-crown text-2xl"></i>
                    <div>
                        <h2 class="text-xl font-bold">Owner Panel</h2>
                        <p class="text-rose-100 text-xs uppercase font-bold tracking-widest">Supreme Control</p>
                    </div>
                </div>
                <button onclick="closeModal()" class="text-white/80 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div class="flex-1 flex overflow-hidden">
                <div class="w-64 border-r border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-gray-950/50 p-4 space-y-2">
                    <button onclick="openOwnerPanel()" class="w-full text-left p-3 rounded-xl bg-white dark:bg-gray-800 shadow-sm font-bold text-sm text-rose-600"><i class="fas fa-users mr-2"></i> User Management</button>
                    <button onclick="checkDatabaseHealth()" class="w-full text-left p-3 rounded-xl hover:bg-white dark:hover:bg-gray-800 text-sm font-medium text-gray-600 dark:text-gray-400"><i class="fas fa-stethoscope mr-2"></i> Database Doctor</button>
                    <button onclick="openCloudSync()" class="w-full text-left p-3 rounded-xl hover:bg-white dark:hover:bg-gray-800 text-sm font-medium text-gray-600 dark:text-gray-400"><i class="fas fa-cloud mr-2"></i> Cloud Sync Control</button>
                </div>
                <div class="flex-1 overflow-y-auto p-4 md:p-6 custom-scrollbar">
                    <div class="mb-6 p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-2xl flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-bold">Supreme Control</h3>
                            <p class="text-[10px] text-emerald-400 uppercase font-bold tracking-widest">Global Studio Management</p>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-black text-white" id="totalUsersCount">--</div>
                            <div class="text-[9px] text-gray-400 uppercase font-bold">Total Accounts</div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="text-left text-xs text-gray-400 uppercase tracking-widest border-b border-gray-100 dark:border-gray-800">
                                    <th class="pb-3 font-bold">User</th>
                                    <th class="pb-3 font-bold">Role</th>
                                    <th class="pb-3 font-bold text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Magic Edit Confirmation -->
        <div id="magicEditModal" class="hidden glass w-full max-w-sm p-6 rounded-2xl shadow-2xl relative text-center">
            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl"><i class="fas fa-magic"></i></div>
            <h2 class="text-xl font-bold mb-2">Magic Style?</h2>
            <p class="text-sm text-gray-500 mb-6">Apply a randomized professional theme to this user's page?</p>
            <div class="flex space-x-2">
                <button onclick="applyMagicStyle()" class="flex-1 p-3 bg-blue-600 text-white rounded-xl font-bold">Apply</button>
                <button onclick="closeModal()" class="flex-1 p-3 bg-gray-100 dark:bg-gray-800 rounded-xl font-bold">Cancel</button>
            </div>
        </div>

        <!-- Manage User Modal -->
        <div id="manageUserModal" class="hidden glass w-full max-w-md p-8 rounded-2xl shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-bold mb-6" id="manageUserTitle">Manage User</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">User Role</label>
                    <select id="manageUserRole" class="w-full p-2 rounded-lg border border-gray-200 outline-none">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <div class="flex items-center space-x-2 p-3 bg-rose-50 dark:bg-rose-900/20 text-rose-600 rounded-xl">
                    <input type="checkbox" id="manageUserMustChange" class="w-4 h-4 rounded">
                    <label for="manageUserMustChange" class="text-xs font-bold">Force password change on next login</label>
                </div>
                <button onclick="saveManageUser()" class="btn-primary w-full p-3 rounded-lg font-semibold">Update User</button>
                <hr>
                <button onclick="deleteSelectedUser()" class="w-full p-3 bg-red-100 text-red-600 rounded-lg font-bold hover:bg-red-200">Delete Account</button>
            </div>
        </div>

        <!-- Cloud Sync Modal -->
        <div id="cloudSyncModal" class="hidden glass w-full max-w-md p-8 rounded-3xl shadow-2xl relative z-10">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors"><i class="fas fa-times"></i></button>
            <div class="flex items-center space-x-3 mb-6">
                <div class="w-10 h-10 bg-purple-600 text-white rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/30"><i class="fas fa-cloud"></i></div>
                <h2 class="text-2xl font-bold">Cloud Sync</h2>
            </div>

            <div class="space-y-6">
                <!-- Status & Toggle -->
                <div class="p-5 bg-white/5 rounded-2xl border border-white/10">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Master Switch</span>
                            <div id="cloudStatusBadge" class="px-2 py-0.5 rounded-full text-[8px] font-bold bg-gray-500 text-white uppercase">OFFLINE</div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="cloudEnabledToggle" class="sr-only peer" onchange="toggleCloudSync()">
                            <div class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500 shadow-inner"></div>
                        </label>
                    </div>
                    <p class="text-[10px] text-gray-500 leading-relaxed">When enabled, SaebMC Studio syncs all users, messages, and groups to your shared Supabase cluster.</p>
                </div>

                <!-- Inputs -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">Supabase Project URL</label>
                        <input type="text" id="syncUrl" class="w-full p-3 text-xs font-mono bg-black/40 border-none outline-none focus:ring-1 focus:ring-purple-500 transition-all" value="https://kuqynhfcfucxyqeldcli.supabase.co">
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-2">Anon Public Key</label>
                        <input type="password" id="syncKey" class="w-full p-3 text-xs font-mono bg-black/40 border-none outline-none focus:ring-1 focus:ring-purple-500 transition-all" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt1cXluaGZjZnVjeHlxZWxkY2xpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MzAyNDAsImV4cCI6MjA4MzUwNjI0MH0.OPm7SlyWPcBAowyQdMXDlzLBtqe-GEZEGHlqsQjVcz8">
                    </div>
                </div>

                <!-- Actions -->
                <div class="grid grid-cols-2 gap-3 pt-2">
                    <button onclick="testCloudConnection()" class="p-3 bg-white/5 border border-white/10 rounded-xl text-xs font-bold uppercase tracking-widest hover:bg-white/10 transition-all">
                        <i class="fas fa-plug mr-2"></i> Test
                    </button>
                    <button onclick="saveCloudConfig()" class="p-3 bg-purple-600 text-white rounded-xl text-xs font-bold uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-lg shadow-purple-600/30">
                        <i class="fas fa-save mr-2"></i> Save
                    </button>
                </div>

                <div class="pt-2">
                    <button onclick="checkDatabaseHealth()" class="w-full p-3 bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:bg-emerald-500/20 transition-all">
                        <i class="fas fa-stethoscope mr-2"></i> Run Deep Diagnostics
                    </button>
                </div>
            </div>
        </div>

        <!-- Notifications Modal -->
        <div id="notificationsModal" class="hidden glass w-full max-w-md p-8 rounded-2xl shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-bold mb-6">Notifications</h2>
            <div id="notificationsList" class="space-y-3 max-h-[400px] overflow-y-auto custom-scrollbar pr-2"></div>
            <button onclick="clearNotifications()" class="w-full mt-6 p-2 text-xs font-bold text-gray-400 hover:text-purple-600 uppercase tracking-widest">Clear All</button>
        </div>
    </div>

    <script>
        // Fix for modal closing by clicking outside
        window.onclick = function(event) {
            const overlay = document.getElementById('modalOverlay');
            if (event.target == overlay) {
                closeModal();
            }
        }
        // ESC key to close modal
        window.onkeydown = function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        }
    </script>
    <script src="app.js" defer></script>
</body>
</html>
